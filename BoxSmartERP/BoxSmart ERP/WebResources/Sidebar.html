<!DOCTYPE html>
<html>
<head>
    <title>Sidebar Menu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="custom-scrollbars.css">
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #2b2d30; /* Dark background matching the top bar */
            color: #ffffff; /* Light text color */
            overflow-x: hidden; /* Prevent horizontal scrollbar if content is too wide */
            overflow-y: auto; /* Allow vertical scrolling if menu items exceed height */
            /* NEW: Flexbox setup for the body to push content to the bottom */
            display: flex;
            flex-direction: column;
            height: 100vh; /* Ensure body takes full viewport height for flex to work */
            padding: 15px; /* Overall padding for the sidebar content */
            box-sizing: border-box; /* Include padding in the element's total width and height */
        }

        /* User Info Styles */
        .user-info {
            display: flex;
            flex-direction: column; /* Changed to column to stack username and full name */
            align-items: center; /* Center horizontally */
            padding: 10px 15px;
            margin-bottom: 20px;
            background-color: #3d4044;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            text-align: center; /* Center text within the block */
        }

            .user-info .user-avatar {
                font-size: 40px; /* Larger icon for avatar */
                margin-bottom: 10px; /* Space between avatar and text */
                color: #0078d7; /* A prominent color for the avatar */
            }

            .user-info .user-full-name { /* New class for full name */
                font-size: 1.1em;
                font-weight: bold;
                color: #ffffff;
                margin-bottom: 2px; /* Small space between full name and username */
            }

            .user-info .user-username { /* New class for username */
                font-size: 0.9em; /* Slightly smaller for username */
                color: #aaaaaa; /* Muted color for username */
            }

        .sidebar-menu {
            list-style: none; /* Remove bullet points from list */
            padding: 0;
            margin: 0;
            width: 100%; /* Take full width of its container (WebView2) */
            flex-grow: 1; /* NEW: Make the menu grow and push activity down */
            margin-bottom: 20px; /* Space between menu and activity */
        }

        .menu-item {
            display: block; /* Make list items behave like blocks for full-width buttons */
            margin-bottom: 2px; /* Small space between buttons */
        }

        .menu-button {
            background-color: transparent; /* No background by default */
            border: none;
            color: #ffffff; /* White text */
            padding: 12px 15px; /* Ample padding for clickability */
            text-align: left; /* Align text to the left */
            font-size: 15px;
            width: 100%; /* Make button fill its parent (menu-item) */
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s; /* Smooth transitions */
            border-radius: 3px; /* Slightly rounded corners */
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
            /* Flexbox for icon and text alignment */
            display: flex;
            align-items: center;
        }

            .menu-button i { /* Styling for the Font Awesome icon */
                margin-right: 10px; /* Space between icon and text */
                font-size: 18px; /* Slightly larger icon size */
                width: 25px; /* Give the icon a fixed width for alignment */
                text-align: center; /* Center the icon within its fixed width */
            }

            .menu-button:hover {
                background-color: rgba(255, 255, 255, 0.1); /* Light hover effect */
            }

            .menu-button:active {
                background-color: rgba(255, 255, 255, 0.15); /* Slightly stronger active effect */
            }

            /* Styling for the active/selected button (optional, but good for UX) */
            .menu-button.active {
                background-color: #0078d7; /* A blue to indicate active state */
                color: #ffffff;
                font-weight: bold;
            }

        /* Indentation for sub-items like "New Request" */
        .indent-item .menu-button {
            padding-left: 30px; /* More padding to indent it */
            font-size: 14px; /* Slightly smaller font for sub-item */
            opacity: 0.9; /* Make it slightly less prominent */
        }
            /* Adjust icon for indented item */
            .indent-item .menu-button i {
                margin-right: 5px; /* Reduce space for indented item */
                font-size: 16px;
            }

        /* Separator style */
        .menu-separator {
            height: 1px;
            background-color: rgba(255, 255, 255, 0.15); /* A subtle line */
            margin: 10px 0; /* Space above and below the separator */
        }

        /* Styles for Recent Activity Section */
        .recent-activity-section {
            padding-top: 15px; /* Padding above title within section */
            border-top: 1px solid rgba(255, 255, 255, 0.1); /* Subtle separator line */
            box-sizing: border-box;
        }

        .recent-activity-title {
            color: #ffffff;
            font-size: 1.1em; /* Adjust as needed, slightly smaller than main menu */
            margin-bottom: 15px;
            font-weight: bold; /* Keep it bold for a title */
        }

        .activity-list {
            /* Container for individual activity items */
        }

        .activity-item {
            background-color: #3d4044; /* Slightly lighter dark for the card-like background */
            border-radius: 5px; /* Rounded corners for the item */
            padding: 10px;
            margin-bottom: 8px; /* Space between activity items */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* Subtle shadow */
            color: #f8f9fa; /* Ensure text inside is light */
        }

        .activity-item-title {
            font-size: 0.95em; /* Slightly smaller font than body default */
            line-height: 1.3;
            margin-bottom: 5px;
            font-weight: normal; /* Not bold */
        }

        .activity-item-time {
            font-size: 0.8em; /* Smaller for timestamp */
            color: #aaaaaa; /* Muted color for timestamp */
        }

        /* Styles for connecting parent to child menu items */
        .menu-item.sub-action {
            position: relative;
            padding-left: 30px; /* Match the padding-left of .indent-item .menu-button for proper alignment */
            margin-top: 0; /* Remove negative margin to align with the line */
        }

            .menu-item.sub-action::before {
                content: "";
                position: absolute;
                top: -10px; /* Adjusted to move lower, doesn't touch the parent button */
                left: 26px; /* Adjusted to move right, center below the parent icon */
                width: 2px;
                height: 34px; /* Length of the vertical line */
                background-color: #ccc; /* Color of the line */
            }

            .menu-item.sub-action::after {
                content: "";
                position: absolute;
                top: 24px; /* Align with the middle of the 'New Request' icon/text */
                left: 26px; /* Align with the vertical line */
                width: 15px; /* Length of the horizontal line */
                height: 2px;
                background-color: #ccc; /* Color of the line */
            }



        .menu-button {
            display: flex;
            align-items: center;
            gap: 0.5rem; /* spacing between icon and text */
        }


    </style>
</head>
<body>
    <div class="user-info">
        <i class="fas fa-user-circle user-avatar"></i>
        <span class="user-full-name" id="userFullName">Full Name Loading...</span>
        <span class="user-username" id="userUsername">@username</span>
    </div>

    <ul class="sidebar-menu">

        <li class="menu-item">
            <button class="menu-button" onclick="sendMessageToHost('dashboard');">
                <i class="fas fa-fw fa-home"></i> Dashboard
            </button>
        </li>
        <li class="menu-item">
            <button class="menu-button" onclick="sendMessageToHost('printcard');">
                <i class="fas fa-fw fa-print"></i> Printcard
            </button>
        </li>
        <li class="menu-item">
            <button class="menu-button" onclick="sendMessageToHost('rubberdie');">
                <i class="fas fa-fw fa-stamp"></i> Rubberdie
            </button>
        </li>
        <li class="menu-item">
            <button class="menu-button" onclick="sendMessageToHost('diecut');">
                <i class="fas fa-fw fa-cut"></i> Diecut
            </button>
        </li>
        <li class="menu-item">
            <button class="menu-button" onclick="sendMessageToHost('mac_schedule');">
                <i class="fas fa-fw fa-calendar-alt"></i> Mac Schedule
            </button>
        </li>
        <li class="menu-item">
            <button class="menu-button" onclick="sendMessageToHost('maintenance');">
                <i class="fas fa-fw fa-tools"></i> Maintenance
            </button>
        </li>

        <li class="menu-item">
            <button class="menu-button" onclick="sendMessageToHost('requests');">
                <i class="fas fa-fw fa-list-alt"></i> Requests
            </button>
        </li>

        <li class="menu-item sub-action">
            <button class="menu-button" onclick="sendMessageToHost('new_request');">
                <i class="fas fa-fw fa-file-circle-plus"></i> New Request
            </button>
        </li>

        <li class="menu-separator"></li>

        <li class="menu-item">
            <button class="menu-button" onclick="sendMessageToHost('logout');">
                <i class="fas fa-fw fa-sign-out-alt"></i> Logout
            </button>
        </li>

    </ul>

    <div class="recent-activity-section">
        <h5 class="recent-activity-title">Recent Activity</h5>
        <div class="activity-list">
            <!-- Content will be inserted here -->
        </div>
    </div>


    <script>


        window.updateActivities = function (activities) {
            try {
                const container = document.querySelector('.activity-list');
                if (!container) {
                    console.error('Activity container not found');
                    return;
                }

                container.innerHTML = '';

                activities.forEach(activity => {
                    const item = document.createElement('div');
                    item.className = 'activity-item';
                    item.innerHTML = `
                <div class="activity-item-title">${escapeHtml(activity.Title)}</div>
                <div class="activity-item-time">${escapeHtml(activity.Time)}</div>
            `;
                    container.appendChild(item);
                });
            } catch (error) {
                console.error('Error updating activities:', error);
            }
        };

        // Simple HTML escaping function
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function sendMessageToHost(action) {
            window.chrome.webview.postMessage(action);

            document.querySelectorAll('.menu-button').forEach(btn => {
                btn.classList.remove('active');
            });
            // 'event.target' might be the 'i' tag if clicked directly on icon.
            // Traverse up to find the button parent.
            let clickedButton = event.target.closest('.menu-button');
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
        }

        // Optional: Call sendMessageToHost for the initial active button on load
        // You might want to ensure one button is active by default, e.g., Dashboard
        document.addEventListener('DOMContentLoaded', () => {
            // Check if there's a stored active state or set default
            // For example, activate dashboard on load if no other state is remembered
            let dashboardButton = document.querySelector('button[onclick="sendMessageToHost(\'dashboard\');"]');
            if (dashboardButton && !document.querySelector('.menu-button.active')) {
                dashboardButton.classList.add('active');
            }
        });
        function updateUserInfo(fullName, username) {
            document.getElementById('userFullName').textContent = fullName;
            document.getElementById('userUsername').textContent = '@' + username;
        }
    </script>
</body>
</html>